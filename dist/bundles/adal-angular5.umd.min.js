!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("adal-angular"),require("@angular/core"),require("rxjs/Rx"),require("@angular/common/http")):"function"==typeof define&&define.amd?define(["exports","adal-angular","@angular/core","rxjs/Rx","@angular/common/http"],e):e(t["adal-angular5"]={},t.adalAngular,t.ng.core,t.Rx,t.ng.common.http)}(this,function(t,o,e,s,a){"use strict";var r=function(){function t(){this.adal5User={authenticated:!1,username:"",error:"",token:"",profile:{}}}return t.prototype.init=function(t){if(!t)throw new Error("You must set config, when calling init.");var e=window.location.hash,r=window.location.href;e&&(r=r.replace(e,"")),t.redirectUri=t.redirectUri||r,t.postLogoutRedirectUri=t.postLogoutRedirectUri||r,this.adalContext=o.inject(t),window.AuthenticationContext=this.adalContext.constructor,this.updateDataFromCache(this.adalContext.config.loginResource)},Object.defineProperty(t.prototype,"config",{get:function(){return this.adalContext.config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userInfo",{get:function(){return this.adal5User},enumerable:!0,configurable:!0}),t.prototype.login=function(){this.adalContext.login()},t.prototype.loginInProgress=function(){return this.adalContext.loginInProgress()},t.prototype.logOut=function(){this.adalContext.logOut()},t.prototype.handleWindowCallback=function(){var t=window.location.hash;if(this.adalContext.isCallback(t)){var e=this.adalContext.getRequestInfo(t);this.adalContext.saveTokenFromHash(e),e.requestType===this.adalContext.REQUEST_TYPE.LOGIN?this.updateDataFromCache(this.adalContext.config.loginResource):e.requestType===this.adalContext.REQUEST_TYPE.RENEW_TOKEN&&(this.adalContext.callback=window.parent.callBackMappedToRenewStates[e.stateResponse]),e.stateMatch&&"function"==typeof this.adalContext.callback&&e.requestType===this.adalContext.REQUEST_TYPE.RENEW_TOKEN&&(e.parameters.access_token?this.adalContext.callback(this.adalContext._getItem(this.adalContext.CONSTANTS.STORAGE.ERROR_DESCRIPTION),e.parameters.access_token):e.parameters.error&&(this.adalContext.callback(this.adalContext._getItem(this.adalContext.CONSTANTS.STORAGE.ERROR_DESCRIPTION),null),this.adalContext._renewFailed=!0))}window.location.hash&&(window.location.href=window.location.href.replace(window.location.hash,""))},t.prototype.getCachedToken=function(t){return this.adalContext.getCachedToken(t)},t.prototype.acquireToken=function(n){var a,i=this;return s.Observable.bindCallback(function(r){var o=null;return i.adalContext.acquireToken(n,function(t,e){t?(i.adalContext.error("Error when acquiring token for resource: "+n,t),a=t,r(null)):(r(e),o=e)}),o},function(t){if(!t&&a)throw a;return t})()},t.prototype.getUser=function(){var t=this;return s.Observable.bindCallback(function(r){t.adalContext.getUser(function(t,e){t?(this.adalContext.error("Error when getting user",t),r(null)):r(e)})})()},t.prototype.clearCache=function(){this.adalContext.clearCache()},t.prototype.clearCacheForResource=function(t){this.adalContext.clearCacheForResource(t)},t.prototype.info=function(t){this.adalContext.info(t)},t.prototype.verbose=function(t){this.adalContext.verbose(t)},t.prototype.GetResourceForEndpoint=function(t){return this.adalContext.getResourceForEndpoint(t)},t.prototype.refreshDataFromCache=function(){this.updateDataFromCache(this.adalContext.config.loginResource)},t.prototype.updateDataFromCache=function(t){var e=this.adalContext.getCachedToken(t);this.adal5User.authenticated=null!==e&&0<e.length;var r=this.adalContext.getCachedUser()||{userName:"",profile:undefined};r?(this.adal5User.username=r.userName,this.adal5User.profile=r.profile,this.adal5User.token=e,this.adal5User.error=this.adalContext.getLoginError()):(this.adal5User.username="",this.adal5User.profile={},this.adal5User.token="",this.adal5User.error="")},t}();r.decorators=[{type:e.Injectable}],r.ctorParameters=function(){return[]};var n=function(){function t(t){this.adal5Service=t}return t.prototype.intercept=function(t,e){return t=t.clone({setHeaders:{Authorization:"Bearer "+this.adal5Service.userInfo.token}}),e.handle(t)},t}();n.decorators=[{type:e.Injectable}],n.ctorParameters=function(){return[{type:r}]};var i=function(){},c=function(){function r(t,e){this.http=t,this.service=e}return r.factory=function(t,e){return new r(t,e)},r.prototype.get=function(t,e){return this.sendRequest("get",t,e)},r.prototype.post=function(t,e,r){return r.body=e,this.sendRequest("post",t,r)},r.prototype["delete"]=function(t,e){return this.sendRequest("delete",t,e)},r.prototype.patch=function(t,e,r){return r.body=e,this.sendRequest("patch",t,r)},r.prototype.put=function(t,e,r){return r.body=e,this.sendRequest("put",t,r)},r.prototype.head=function(t,e){return this.sendRequest("head",t,e)},r.prototype.sendRequest=function(e,r,o){var n=this,t=this.service.GetResourceForEndpoint(r);return t?this.service.userInfo.authenticated?this.service.acquireToken(t).flatMap(function(t){return null==o.headers&&(o.headers=new a.HttpHeaders),o.headers=o.headers.append("Authorization","Bearer "+t),n.http.request(e,r,o)["catch"](n.handleError)}):s.Observable["throw"](new Error("User Not Authenticated.")):this.http.request(e,r,o)["catch"](this.handleError)},r.prototype.handleError=function(t){t.message;return console.error(JSON.stringify(t)),s.Observable["throw"](t)},r}();c.decorators=[{type:e.Injectable}],c.ctorParameters=function(){return[{type:a.HttpClient},{type:r}]};var u=function(){};u.decorators=[{type:e.NgModule,args:[{imports:[],exports:[i,r,c,n],providers:[{provide:a.HTTP_INTERCEPTORS,useClass:n,multi:!0}]}]}],u.ctorParameters=function(){return[]},t.Adal5AngularModule=u,t.ɵc=c,t.ɵd=n,t.ɵa=i,t.ɵb=r,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=adal-angular5.umd.min.js.map
