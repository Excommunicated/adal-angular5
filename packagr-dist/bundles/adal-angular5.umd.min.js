!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/Observable"),require("adal-angular"),require("rxjs/Rx"),require("@angular/common/http"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/Observable","adal-angular","rxjs/Rx","@angular/common/http","@angular/common"],t):t(e["adal-angular5"]={},e.ng.core,e.Rx,e.adalAngular,e.Rx,e.ng.common.http,e.ng.common)}(this,function(e,t,n,o,a,i,r){"use strict";var s=function(){function e(){this.adal5User={authenticated:!1,username:"",error:"",token:"",profile:{}}}return e.prototype.init=function(e){if(!e)throw new Error("You must set config, when calling init.");var t=window.location.hash,n=window.location.href;t&&(n=n.replace(t,"")),e.redirectUri=e.redirectUri||n,e.postLogoutRedirectUri=e.postLogoutRedirectUri||n,this.adalContext=o.inject(e),window.AuthenticationContext=this.adalContext.constructor,this.updateDataFromCache(this.adalContext.config.loginResource)},Object.defineProperty(e.prototype,"config",{get:function(){return this.adalContext.config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userInfo",{get:function(){return this.adal5User},enumerable:!0,configurable:!0}),e.prototype.login=function(){this.adalContext.login()},e.prototype.loginInProgress=function(){return this.adalContext.loginInProgress()},e.prototype.logOut=function(){this.adalContext.logOut()},e.prototype.handleWindowCallback=function(){var e=window.location.hash;if(this.adalContext.isCallback(e)){var t=(0<this.adalContext._openedWindows.length&&this.adalContext._openedWindows[this.adalContext._openedWindows.length-1].opener&&this.adalContext._openedWindows[this.adalContext._openedWindows.length-1].opener._adalInstance?this.adalContext._openedWindows[this.adalContext._openedWindows.length-1].opener._adalInstance:window.parent&&window.parent._adalInstance?window.parent._adalInstance:this.adalContext).getRequestInfo(e);this.adalContext.saveTokenFromHash(t),t.requestType===this.adalContext.REQUEST_TYPE.LOGIN?this.updateDataFromCache(this.adalContext.config.loginResource):t.requestType===this.adalContext.REQUEST_TYPE.RENEW_TOKEN&&(this.adalContext.callback=window.parent.callBackMappedToRenewStates[t.stateResponse]),t.stateMatch&&"function"==typeof this.adalContext.callback&&t.requestType===this.adalContext.REQUEST_TYPE.RENEW_TOKEN&&(t.parameters.access_token?this.adalContext.callback(this.adalContext._getItem(this.adalContext.CONSTANTS.STORAGE.ERROR_DESCRIPTION),t.parameters.access_token):t.parameters.id_token?this.adalContext.callback(this.adalContext._getItem(this.adalContext.CONSTANTS.STORAGE.ERROR_DESCRIPTION),t.parameters.id_token):t.parameters.error&&(this.adalContext.callback(this.adalContext._getItem(this.adalContext.CONSTANTS.STORAGE.ERROR_DESCRIPTION),null),this.adalContext._renewFailed=!0))}window.location.hash&&(window.location.href=window.location.href.replace(window.location.hash,""))},e.prototype.getCachedToken=function(e){return this.adalContext.getCachedToken(e)},e.prototype.acquireToken=function(r){var a,i=this;return n.Observable.bindCallback(function(n){var o=null;return i.adalContext.acquireToken(r,function(e,t){e?(i.adalContext.error("Error when acquiring token for resource: "+r,e),a=e,n(null)):(n(t),o=t)}),o},function(e){if(!e&&a)throw a;return e})()},e.prototype.getUser=function(){var e=this;return n.Observable.bindCallback(function(n){e.adalContext.getUser(function(e,t){e?(this.adalContext.error("Error when getting user",e),n(null)):n(t)})})()},e.prototype.clearCache=function(){this.adalContext.clearCache()},e.prototype.clearCacheForResource=function(e){this.adalContext.clearCacheForResource(e)},e.prototype.info=function(e){this.adalContext.info(e)},e.prototype.verbose=function(e){this.adalContext.verbose(e)},e.prototype.GetResourceForEndpoint=function(e){return this.adalContext.getResourceForEndpoint(e)},e.prototype.refreshDataFromCache=function(){this.updateDataFromCache(this.adalContext.config.loginResource)},e.prototype.updateDataFromCache=function(e){var t=this.adalContext.getCachedToken(e);this.adal5User.authenticated=null!==t&&0<t.length;var n=this.adalContext.getCachedUser()||{userName:"",profile:undefined};n?(this.adal5User.username=n.userName,this.adal5User.profile=n.profile,this.adal5User.token=t,this.adal5User.error=this.adalContext.getLoginError()):(this.adal5User.username="",this.adal5User.profile={},this.adal5User.token="",this.adal5User.error="")},e}();s.decorators=[{type:t.Injectable}],s.ctorParameters=function(){return[]};var l=function(){function n(e,t){this.http=e,this.service=t}return n.factory=function(e,t){return new n(e,t)},n.prototype.get=function(e,t){return this.sendRequest("get",e,t)},n.prototype.post=function(e,t,n){return n.body=t,this.sendRequest("post",e,n)},n.prototype["delete"]=function(e,t){return this.sendRequest("delete",e,t)},n.prototype.patch=function(e,t,n){return n.body=t,this.sendRequest("patch",e,n)},n.prototype.put=function(e,t,n){return n.body=t,this.sendRequest("put",e,n)},n.prototype.head=function(e,t){return this.sendRequest("head",e,t)},n.prototype.sendRequest=function(t,n,o){var r=this;o||(o={body:null,headers:null,reportProgress:null,observe:"response",params:null,responseType:"json",withCredentials:null});var e=this.service.GetResourceForEndpoint(n);return e?this.service.userInfo.authenticated?this.service.acquireToken(e).flatMap(function(e){return null==o.headers&&(o.headers=new i.HttpHeaders),o.headers=o.headers.append("Authorization","Bearer "+e),r.http.request(t,n,o)["catch"](r.handleError)}):a.Observable["throw"](new Error("User Not Authenticated.")):this.http.request(t,n,o)["catch"](this.handleError)},n.prototype.handleError=function(e){e.message;return console.error(JSON.stringify(e)),a.Observable["throw"](e)},n}();l.decorators=[{type:t.Injectable}],l.ctorParameters=function(){return[{type:i.HttpClient},{type:s}]};var c=function(){function e(e){this.adal5Service=e}return e.prototype.intercept=function(e,t){return e=e.clone({setHeaders:{Authorization:"Bearer "+this.adal5Service.userInfo.token}}),t.handle(e)},e}();c.decorators=[{type:t.Injectable}],c.ctorParameters=function(){return[{type:s}]};var d=function(){},u=function(){};u.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule]}]}],u.ctorParameters=function(){return[]},e.Adal5HTTPService=l,e.Adal5Interceptor=c,e.Adal5User=d,e.Adal5Service=s,e.Adal5AngularModule=u,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=adal-angular5.umd.min.js.map
